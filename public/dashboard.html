<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Harsh Shah Portfolio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        background: 'hsl(var(--background))',
                        foreground: 'hsl(var(--foreground))',
                        card: {
                            DEFAULT: 'hsl(var(--card))',
                            foreground: 'hsl(var(--card-foreground))',
                        },
                        popover: {
                            DEFAULT: 'hsl(var(--popover))',
                            foreground: 'hsl(var(--popover-foreground))',
                        },
                        primary: {
                            DEFAULT: 'hsl(var(--primary))',
                            foreground: 'hsl(var(--primary-foreground))',
                        },
                        secondary: {
                            DEFAULT: 'hsl(var(--secondary))',
                            foreground: 'hsl(var(--secondary-foreground))',
                        },
                        muted: {
                            DEFAULT: 'hsl(var(--muted))',
                            foreground: 'hsl(var(--muted-foreground))',
                        },
                        accent: {
                            DEFAULT: 'hsl(var(--accent))',
                            foreground: 'hsl(var(--accent-foreground))',
                        },
                        destructive: {
                            DEFAULT: 'hsl(var(--destructive))',
                            foreground: 'hsl(var(--destructive-foreground))',
                        },
                        border: 'hsl(var(--border))',
                        input: 'hsl(var(--input))',
                        ring: 'hsl(var(--ring))',
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --popover: 0 0% 100%;
            --popover-foreground: 222.2 84% 4.9%;
            --primary: 221.2 83.2% 53.3%;
            --primary-foreground: 210 40% 98%;
            --primary-glow: 221.2 83.2% 63.3%;
            --secondary: 210 40% 96%;
            --secondary-foreground: 222.2 84% 4.9%;
            --muted: 210 40% 96%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96%;
            --accent-foreground: 222.2 84% 4.9%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --ring: 221.2 83.2% 53.3%;
            --card-gradient: linear-gradient(145deg, hsl(0 0% 100%), hsl(210 40% 98%));
            --text-gradient: linear-gradient(135deg, hsl(221.2 83.2% 53.3%), hsl(189 85% 55%));
            --shadow-card: 0 8px 32px hsl(220 13% 20% / 0.1);
            --shadow-subtle: 0 2px 8px hsl(220 13% 20% / 0.05);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            --radius: 0.5rem;
        }
        .dark {
            --background: 222.2 84% 4.9%;
            --foreground: 210 40% 98%;
            --card: 222.2 84% 4.9%;
            --card-foreground: 210 40% 98%;
            --popover: 222.2 84% 4.9%;
            --popover-foreground: 210 40% 98%;
            --primary: 217.2 91.2% 59.8%;
            --primary-foreground: 222.2 47.4% 11.2%;
            --primary-glow: 217.2 91.2% 69.8%;
            --secondary: 217.2 32.6% 17.5%;
            --secondary-foreground: 210 40% 98%;
            --muted: 217.2 32.6% 17.5%;
            --muted-foreground: 215 20.2% 65.1%;
            --accent: 217.2 32.6% 17.5%;
            --accent-foreground: 210 40% 98%;
            --destructive: 0 14.8% 30.6%;
            --destructive-foreground: 210 40% 98%;
            --border: 217.2 32.6% 17.5%;
            --input: 217.2 32.6% 17.5%;
            --ring: 217.2 91.2% 59.8%;
            --card-gradient: linear-gradient(145deg, hsl(217.2 32.6% 17.5%), hsl(222.2 84% 4.9%));
            --text-gradient: linear-gradient(135deg, hsl(217.2 91.2% 59.8%), hsl(189 85% 55%));
            --shadow-card: 0 8px 32px hsl(220 13% 3% / 0.4);
            --shadow-subtle: 0 2px 8px hsl(220 13% 3% / 0.2);
        }
        .text-gradient {
            background: var(--text-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .card-gradient {
            background: var(--card-gradient);
            border: 1px solid hsl(var(--border));
        }
        .card-hover {
            transition: var(--transition-smooth);
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-card);
        }
        .hover-glow:hover {
            box-shadow: 0 0 20px hsl(var(--primary) / 0.4);
        }
        .transition-smooth {
            transition: var(--transition-smooth);
        }
        .transition-fast {
            transition: var(--transition-fast);
        }
        * {
            border-color: hsl(var(--border));
        }
        body {
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        .coverage-excellent {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%) !important;
            box-shadow: 0 0 4px 1px rgba(59, 130, 246, 0.4);
            border: 1.5px solid #3b82f6;
        }
    </style>
</head>
<body class="bg-background text-foreground min-h-screen transition-colors duration-300">
    <!-- Header -->
    <header class="bg-background/80 backdrop-blur-md border-b border-border shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <!-- Logo/Brand -->
                <div class="flex-shrink-0">
                    <div class="flex flex-col">
                        <h1 class="text-xl font-bold text-gradient">Dashboard</h1>
                        <p class="text-foreground text-sm">Project Metrics & Quality Overview</p>
                    </div>
                </div>
                <!-- Right side controls -->
                <div class="flex items-center space-x-4">
                    <!-- Theme Toggle -->
                    <button id="themeToggle" class="hover-glow rounded-full p-0 w-10 h-10 flex items-center justify-center group">
                        <div class="rounded-full bg-transparent p-2 group-hover:bg-primary/20 group-focus:bg-primary/20 group-active:bg-primary/20 transition-colors">
                            <i data-lucide="moon" class="w-4 h-4 text-foreground group-hover:text-primary group-focus:text-primary group-active:text-primary transition-colors"></i>
                        </div>
                    </button>
                    <!-- Back to Portfolio Link -->
                    <a href="/harsh-portfolio/" class="hover-glow rounded-full p-0 w-10 h-10 flex items-center justify-center group">
                        <div class="rounded-full bg-transparent p-2 group-hover:bg-primary/20 group-focus:bg-primary/20 group-active:bg-primary/20 transition-colors">
                            <i data-lucide="home" class="w-4 h-4 text-foreground group-hover:text-primary group-focus:text-primary group-active:text-primary transition-colors"></i>
                        </div>
                    </a>
                    <!-- Last Updated -->
                    <div class="text-right hidden sm:block">
                        <div class="text-xs text-foreground">Last Updated</div>
                        <div id="lastUpdated" class="text-sm font-semibold text-foreground">Loading...</div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Overview Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- Overall Coverage -->
            <div class="card-gradient rounded-2xl shadow-card card-hover hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300 p-6">
                <div class="flex items-center justify-between">
                    <div class="p-3 bg-primary/10 rounded-full flex items-center justify-center transition-smooth group-hover:bg-primary/20" style="width: 48px; height: 48px;">
                        <i data-lucide="bar-chart-3" class="w-6 h-6" style="color: #3b82f6"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-foreground">Overall Coverage</p>
                        <p id="overallCoverage" class="text-2xl font-bold text-gradient">94.69%</p>
                        <p class="text-sm text-primary font-medium mt-1">✓ Industry Standard: 80%</p>
                    </div>
                </div>
            </div>
            <!-- Total Tests -->
            <div class="card-gradient rounded-2xl shadow-card card-hover hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300 p-6">
                <div class="flex items-center justify-between">
                    <div class="p-3 bg-primary/10 rounded-full flex items-center justify-center transition-smooth group-hover:bg-primary/20" style="width: 48px; height: 48px;">
                        <i data-lucide="check-circle" class="w-6 h-6" style="color: #3b82f6"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-foreground">Total Tests</p>
                        <p id="totalTests" class="text-2xl font-bold text-gradient"></p>
                        <p class="text-sm text-primary font-medium mt-1">✓ All tests passing</p>
                    </div>
                </div>
            </div>
            <!-- Function Coverage -->
            <div class="card-gradient rounded-2xl shadow-card card-hover hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300 p-6">
                <div class="flex items-center justify-between">
                    <div class="p-3 bg-primary/10 rounded-full flex items-center justify-center transition-smooth group-hover:bg-primary/20" style="width: 48px; height: 48px;">
                        <i data-lucide="function-square" class="w-6 h-6" style="color: #3b82f6"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-foreground">Function Coverage</p>
                        <p id="functionCoverage" class="text-2xl font-bold text-gradient">84.7%</p>
                        <p id="functionCoverageThreshold" class="text-sm text-primary font-medium mt-1"></p>
                    </div>
                </div>
            </div>
            <!-- Security Score -->
            <div class="card-gradient rounded-2xl shadow-card card-hover hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300 p-6">
                <div class="flex items-center justify-between">
                    <div class="p-3 bg-primary/10 rounded-full flex items-center justify-center transition-smooth group-hover:bg-primary/20" style="width: 48px; height: 48px;">
                        <i data-lucide="shield-check" class="w-6 h-6" style="color: #3b82f6"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-foreground">Security Score</p>
                        <p id="securityScore" class="text-2xl font-bold text-gradient"></p>
                        <p id="securityStatus" class="text-sm text-primary font-medium mt-1"></p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
            <!-- Coverage Breakdown -->
            <div class="card-gradient rounded-2xl shadow-card card-hover hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300 p-6">
                <h3 class="text-lg font-semibold text-foreground mb-4">Coverage Breakdown</h3>
                <div class="h-64">
                    <canvas id="coverageChart"></canvas>
                </div>
            </div>
            <!-- Test Results Trend -->
            <div class="card-gradient rounded-2xl shadow-card card-hover hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300 p-6">
                <h3 class="text-lg font-semibold text-foreground mb-4">Test Results Trend</h3>
                <div class="h-64">
                    <canvas id="testTrendChart"></canvas>
                </div>
            </div>
        </div>
        <!-- Detailed Metrics -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
            <!-- Component Coverage -->
            <div class="card-gradient rounded-2xl shadow-card card-hover hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300 p-6">
                <h3 class="text-lg font-semibold text-foreground mb-4">Component Coverage</h3>
                <div id="componentCoverageList" class="space-y-4"></div>
            </div>
            <!-- Test Categories -->
            <div class="card-gradient rounded-2xl shadow-card card-hover hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300 p-6">
                <h3 class="text-lg font-semibold text-foreground mb-4">Test Categories</h3>
                <div id="testCategoriesList" class="space-y-4"></div>
            </div>
            <!-- Quality Metrics -->
            <div class="card-gradient rounded-2xl shadow-card card-hover hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300 p-6">
                <h3 class="text-lg font-semibold text-foreground mb-4">Quality Metrics</h3>
                <div id="qualityMetricsList" class="space-y-4"></div>
            </div>
        </div>
        <!-- CI/CD Status -->
        <div class="card-gradient rounded-2xl shadow-card card-hover hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300 p-6 mb-8">
            <h3 class="text-lg font-semibold text-foreground mb-4">CI/CD Pipeline Status</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="flex items-center p-4 bg-primary/5 dark:bg-primary/10 rounded-lg hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300">
                    <div class="p-2 bg-primary/10 rounded-full flex items-center justify-center transition-smooth mr-4 group-hover:bg-primary/20 group-focus:bg-primary/20 group-active:bg-primary/20" style="width: 40px; height: 40px;">
                        <i data-lucide="check-circle" class="w-5 h-5" style="color: #3b82f6"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-foreground">Test Pipeline</p>
                        <p id="ciStatus" class="text-sm text-primary"></p>
                    </div>
                </div>
                <div class="flex items-center p-4 bg-primary/5 dark:bg-primary/10 rounded-lg hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300">
                    <div class="p-2 bg-primary/10 rounded-full flex items-center justify-center transition-smooth mr-4 group-hover:bg-primary/20 group-focus:bg-primary/20 group-active:bg-primary/20" style="width: 40px; height: 40px;">
                        <i data-lucide="check-circle" class="w-5 h-5" style="color: #3b82f6"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-foreground">Coverage</p>
                        <p class="text-sm text-primary" id="coverageStatus"></p>
                    </div>
                </div>
                <div class="flex items-center p-4 bg-primary/5 dark:bg-primary/10 rounded-lg hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300">
                    <div class="p-2 bg-primary/10 rounded-full flex items-center justify-center transition-smooth mr-4 group-hover:bg-primary/20 group-focus:bg-primary/20 group-active:bg-primary/20" style="width: 40px; height: 40px;">
                        <i data-lucide="check-circle" class="w-5 h-5" style="color: #3b82f6"></i>
                    </div>
                    <div>
                        <p class="text-sm font-medium text-foreground">Deployment</p>
                        <p id="deploymentStatus" class="text-sm text-primary"></p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Action Items -->
        <div class="card-gradient rounded-2xl shadow-card card-hover hover:shadow-[0_0_20px_hsl(var(--primary)/0.4)] hover:-translate-y-1 transition-all duration-300 p-6">
            <h3 class="text-lg font-semibold text-foreground mb-4">Next Steps to Improve Coverage</h3>
            <div id="coverageRecommendations"></div>
        </div>
    </main>
    <!-- Footer -->
    <footer class="bg-muted text-muted-foreground py-8 mt-12 border-t border-border">
        <div class="container mx-auto px-6 text-center">
            <p class="text-foreground">Dashboard - Built with ❤️ by <span class="text-gradient font-semibold">Harsh Shah</span></p>
            <p class="text-sm text-foreground mt-2">Automatically updated via CI/CD pipeline</p>
        </div>
    </footer>
    <script>
        const THEME_KEY = 'portfolio-ui-theme';
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;

        function getPreferredTheme() {
            const saved = localStorage.getItem(THEME_KEY);
            if (saved === 'light' || saved === 'dark') return saved;
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function setTheme(theme) {
            html.classList.remove('light', 'dark');
            html.classList.add(theme);
            localStorage.setItem(THEME_KEY, theme);
            updateThemeIcon();
        }

        function updateThemeIcon() {
            const iconContainer = themeToggle.querySelector('div');
            if (!iconContainer) return;
            // Remove ALL children (not just <i>) to guarantee a clean state
            while (iconContainer.firstChild) {
                iconContainer.removeChild(iconContainer.firstChild);
            }
            // Create new icon element
            const icon = document.createElement('i');
            icon.className = 'w-4 h-4 text-foreground group-hover:text-primary group-focus:text-primary group-active:text-primary transition-colors';
            icon.setAttribute('data-lucide', html.classList.contains('dark') ? 'sun' : 'moon');
            iconContainer.appendChild(icon);
            lucide.createIcons();
        }

        // On page load
        const initialTheme = getPreferredTheme();
        setTheme(initialTheme);

        // Toggle handler
        let chartLabels = null;
        let chartCoverageTrend = null;
        let chartTestTrend = null;
        themeToggle.addEventListener('click', () => {
            const current = html.classList.contains('dark') ? 'dark' : 'light';
            const next = current === 'dark' ? 'light' : 'dark';
            setTheme(next);
            updateCharts(window.dashboardData, chartLabels, chartCoverageTrend, chartTestTrend);
        });
        // Initialize Lucide icons
        lucide.createIcons();

        // Fetch dashboard-data.json and update metrics
        fetch('dashboard-data.json')
          .then(res => res.json())
          .then(data => {
            window.dashboardData = data;
            // Update metrics
            document.getElementById('overallCoverage').textContent = data.coverage.percentage + '%';
            const funcThreshold = data.functions?.threshold ?? 65;
            document.getElementById('functionCoverageThreshold').textContent = `✓ Exceeds ${funcThreshold}% threshold`;
            document.getElementById('totalTests').textContent = data.tests.count;
            document.getElementById('lastUpdated').textContent = new Date(data.lastUpdated).toLocaleString();
            // Update CI/CD status
            const ciStatus = data.workflows?.ci;
            const deployStatus = data.workflows?.deploy;
            const ciText = ciStatus === "success"
              ? "✓ All checks passed"
              : "✗ CI failed";
            const deployText = deployStatus === "success"
              ? "✓ GitHub Pages active"
              : "✗ Deployment failed";
            document.getElementById('ciStatus').textContent = ciText;
            document.getElementById('deploymentStatus').textContent = deployText;
            document.getElementById('coverageStatus').textContent = `✓ ${data.coverage.percentage}% coverage`;
            // Update Security Score
            document.getElementById('securityScore').textContent = (data.security?.score ?? '-') + '%';
            document.getElementById('securityStatus').textContent =
              data.security?.highSeverityIssues === 0
                ? '✓ No high severity issues'
                : `✗ ${data.security.highSeverityIssues} high severity issues`;
            // Fetch and update trend chart with real history
            fetch('dashboard-history.json')
              .then(res => res.json())
              .then(history => {
                chartLabels = history.map(entry => entry.date);
                chartCoverageTrend = history.map(entry => entry.coverage);
                chartTestTrend = history.map(entry => entry.tests);
                updateCharts(data, chartLabels, chartCoverageTrend, chartTestTrend);
              });
            // Update coverage bar if present
            if (document.getElementById('coverageBar')) {
              const coverage = data.coverage.percentage;
              const bar = document.getElementById('coverageBar');
              const coverageText = document.getElementById('overallCoverage');
              if (coverage >= 80) {
                  bar.className = 'coverage-excellent h-2 rounded-full';
              } else if (coverage >= 60) {
                  bar.className = 'coverage-good h-2 rounded-full';
              } else {
                  bar.className = 'coverage-poor h-2 rounded-full';
              }
              bar.style.width = coverage + '%';
              coverageText.textContent = coverage + '%';
            }
            const componentCoverageList = document.getElementById('componentCoverageList');
            if (componentCoverageList && Array.isArray(data.componentCoverage)) {
              componentCoverageList.innerHTML = '';
              data.componentCoverage.forEach(comp => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between';
                div.innerHTML = `<span class="text-sm font-medium text-foreground">${comp.name}</span><span class="text-sm font-bold text-primary">${comp.coverage}%</span>`;
                componentCoverageList.appendChild(div);
              });
            }
            const testCategoriesList = document.getElementById('testCategoriesList');
            if (testCategoriesList && Array.isArray(data.testCategories)) {
              testCategoriesList.innerHTML = '';
              data.testCategories.forEach(cat => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between';
                div.innerHTML = `<span class="text-sm font-medium text-foreground">${cat.name}</span><span class="text-sm font-bold text-primary">${cat.count}</span>`;
                testCategoriesList.appendChild(div);
              });
            }
            const qualityMetricsList = document.getElementById('qualityMetricsList');
            if (qualityMetricsList) {
              let metrics = [
                { label: 'TypeScript Coverage', value: (data.quality?.typescriptCoverage ?? '100%') },
                { label: 'Linting Score', value: (data.quality?.lintingScore ?? '100%') },
                { label: 'Build Success Rate', value: (data.quality?.buildSuccessRate ?? '100%') },
                { label: 'Deployment Success', value: (data.quality?.deploymentSuccess ?? '100%') },
                { label: 'Security Vulnerabilities', value: (data.quality?.securityVulnerabilities ?? data.security?.highSeverityIssues ?? 0) }
              ];
              // Sort: percentages descending, vulnerabilities ascending (0 best)
              metrics = metrics.sort((a, b) => {
                if (a.label === 'Security Vulnerabilities') return 1;
                if (b.label === 'Security Vulnerabilities') return -1;
                // Remove % and parse as number
                const aVal = parseFloat((a.value + '').replace('%', ''));
                const bVal = parseFloat((b.value + '').replace('%', ''));
                return bVal - aVal;
              });
              // Place vulnerabilities at the end, but if 0, place at the top
              if (metrics[metrics.length - 1].label === 'Security Vulnerabilities' && metrics[metrics.length - 1].value === 0) {
                const vuln = metrics.pop();
                metrics.unshift(vuln);
              }
              qualityMetricsList.innerHTML = '';
              metrics.forEach(metric => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between';
                div.innerHTML = `<span class="text-sm font-medium text-foreground">${metric.label}</span><span class="text-sm font-bold text-primary">${metric.value}</span>`;
                qualityMetricsList.appendChild(div);
              });
            }
            const coverageRecommendations = document.getElementById('coverageRecommendations');
            if (coverageRecommendations && Array.isArray(data.recommendations)) {
              coverageRecommendations.innerHTML = '';
              data.recommendations.forEach(priority => {
                const div = document.createElement('div');
                div.className = 'mb-6';
                div.innerHTML = `<h4 class=\"font-medium text-foreground mb-3\">${priority.title}</h4>`;
                const ul = document.createElement('ul');
                ul.className = 'space-y-2 text-sm text-foreground';
                priority.items.forEach(item => {
                  const li = document.createElement('li');
                  li.className = 'flex items-center';
                  li.innerHTML = `<i data-lucide=\"circle\" class=\"w-3 h-3 mr-2 text-primary\"></i>${item}`;
                  ul.appendChild(li);
                });
                div.appendChild(ul);
                coverageRecommendations.appendChild(div);
              });
            }
          });

        // Chart configuration
        const isDark = () => html.classList.contains('dark');
        const textColor = () => isDark() ? '#e5e7eb' : '#374151';
        const gridColor = () => isDark() ? '#374151' : '#e5e7eb';
        // Global chart instances
        let coverageChart = null;
        let trendChart = null;
        function updateCharts(data, trendLabels, coverageTrend, testTrend) {
            // Coverage Chart
            const coverageCtx = document.getElementById('coverageChart');
            if (!coverageCtx) {
                console.error('Coverage chart canvas not found');
                return;
            }
            if (coverageChart) {
                coverageChart.destroy();
            }
            const covered = data?.coverage?.percentage ?? 0;
            const uncovered = 100 - covered;
            coverageChart = new Chart(coverageCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Covered', 'Uncovered'],
                    datasets: [{
                        data: [covered, uncovered],
                        backgroundColor: ['#3b82f6', '#22d3ee'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: textColor(),
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
            // Test Trend Chart
            const trendCtx = document.getElementById('testTrendChart');
            if (!trendCtx) {
                console.error('Trend chart canvas not found');
                return;
            }
            if (trendChart) {
                trendChart.destroy();
            }
            trendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: trendLabels || ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7'],
                    datasets: [{
                        label: 'Coverage %',
                        data: coverageTrend || [13.5, 27, 40.5, 54, 67.5, 81, data?.coverage?.percentage ?? 0],
                        borderColor: '#22d3ee',
                        backgroundColor: 'rgba(34, 211, 238, 0.1)',
                        tension: 0.4,
                        borderWidth: 3,
                        pointBackgroundColor: '#22d3ee',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }, {
                        label: 'Test Count',
                        data: testTrend || [50, 72, 89, 110, 152, 288, data?.tests?.count ?? 0],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        borderWidth: 3,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: textColor(),
                                padding: 20,
                                usePointStyle: true
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: gridColor(),
                                drawBorder: false
                            },
                            ticks: {
                                color: textColor(),
                                padding: 10
                            }
                        },
                        x: {
                            grid: {
                                color: gridColor(),
                                drawBorder: false
                            },
                            ticks: {
                                color: textColor(),
                                padding: 10
                            }
                        }
                    },
                    elements: {
                        point: {
                            hoverRadius: 8
                        }
                    }
                }
            });
        }
        function renderLucideIcons() {
            if (window.lucide && typeof window.lucide.createIcons === 'function') {
                window.lucide.createIcons();
            }
        }
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                renderLucideIcons();
                // updateCharts will be called after fetch
            }, 100);
        });
        setInterval(() => {
            if (window.dashboardData) {
                document.getElementById('lastUpdated').textContent = new Date(window.dashboardData.lastUpdated).toLocaleString();
            }
        }, 300000);
    </script>
</body>
</html> 